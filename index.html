<!DOCTYPE html>
<html>
  <head>
    <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <link rel="import" href="bower_components/core-scaffold/core-scaffold.html">
    <link rel="import" href="bower_components/core-item/core-item.html">
    <link rel="import" href="bower_components/paper-input/paper-input.html">
    <link rel="import" href="bower_components/paper-fab/paper-fab.html">
    <link rel="import" href="x-chat-list.html">
    <link rel="import" href="bower_components/pubnub-polymer/pubnub-element.html">
  </head>

  <body fullbleed unresolved>
      <template is="auto-binding">

          <core-pubnub
              publish_key="pub-c-156a6d5f-22bd-4a13-848d-b5b4d4b36695"
              subscribe_key="sub-c-f762fb78-2724-11e4-a4df-02ee2ddab7fe"
              uuid="{{uuid}}">
              <core-pubnub-subscribe channel="polymer-chat" id="sub" messages="{{messages}}" on-callback="{{subscribeCallback}}">
                  <core-pubnub-publish channel="polymer-chat" id="pub" message=""></core-pubnub-publish>
              </core-pubnub-subscribe>
          </core-pubnub>

          <core-scaffold>
              <!-- Drawer panel -->
              <core-header-panel navigation flex>
                  <core-toolbar class="tall">
                      <!-- an avatar and username will be here -->
                  </core-toolbar>
              </core-header-panel>
              <!-- App Title -->
              <div tool layout horizontal flex>
                  <span flex>Kitteh Anonymous</span>
                  <core-icon icon="account-circle"></core-icon>
                  <span><!-- number of people online --></span>
              </div>
              <!-- Main content -->
              <div flex class="chat-list">
                  <template repeat="{{message in messages}}">
                      <x-chat-list color="{{message.color}}"
                                   avatar="{{message.avatar}}"
                                   username="{{message.uuid}}"
                                   text="{{message.text}}"></x-chat-list>
                  </template>
              </div>
              <div flex>
                <div class="send-message" layout horizontal>
                  <paper-input flex label="Type message..." id="input" value="{{input}}"></paper-input>
                  <paper-fab icon="send" id="sendButton" on-tap="{{sendMyMessage}}"></paper-fab>
                </div>
              </div>
          </core-scaffold>
      </template>
    <script>
        (function() {
            'use strict';
            var uuid, avatar, color, cat;
            // Assign a uuid made of a random cat and a random color
            var randomColor = function () {
                var colors = ['navy', 'slate', 'olive', 'moss', 'chocolate', 'buttercup', 'maroon', 'cerise', 'plum', 'orchid'];
                return colors[(Math.random() * colors.length) >>> 0];
            };
            var randomCat = function () {
                var cats = ['tabby', 'bengal', 'persian', 'mainecoon', 'ragdoll', 'sphynx', 'siamese', 'korat', 'japanesebobtail', 'abyssinian', 'scottishfold'];
                return cats[(Math.random() * cats.length) >>> 0];
            };

            color = randomColor();
            cat = randomCat();
            uuid = color + '-' + cat;
            avatar = 'images/' + cat + '.jpg';

            template.items = [
                {icon: 'cloud', title: 'PubNub'},
                {icon: 'polymer', title: 'Polymer'},
                {icon: 'favorite', title: 'Love'}
            ];

            template.sendMyMessage = function(e) {
                if(!template.input) return; // if the input field is empty, do nothing.

                template.$.pub.message = {
                    uuid: uuid,
                    avatar: avatarUrl,
                    color: color,
                    text: template.input
                };
                template.$.pub.publish();
            };
        })();
    </script>
  </body>
</html>
